<!DOCTYPE html>
<html>

<head>
    <title>资讯</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script src="/javascripts/jquery.js"></script>
    <style>

    </style>
</head>

<body>
    <header id="header">
        <div class="head"><i class="btn-toggle-panel"></i><span class="head-title">发现</span></div>
    </header>
    <div class="container">
        <ul class="item-list" id="item-list-box">
            <% for(var i=0,len=article.length;i<len;i++){ %>
                <li class="item">
                    <div class="item-inner">
                        <a href="<%= article[i].articleLink %>" target="_blank" class="item-link">
                            <h3>
                                <%= article[i].articleTitle %>
                            </h3>
                            <div class="meto-row"><span class="tags bule"><%= article[i].articleTag %></span><span><%= article[i].articleAuthor %></span><span><%= article[i].articlePvn %></span></div>
                        </a>
                    </div>
                </li>
                <% } %>
        </ul>
        <% if( pageNum > page ){ %>
            <button type="button" class="btn-loadmore">加载更多</button>
            <% } %>
    </div>
</body>
<script>
    $(function() {
        var currenPage = '<%= page %>' || 1;
        var $btnMore = $(".btn-loadmore");
        console.log(currenPage + 1)
        $btnMore.on('click', function() {
            $.ajax({
                type: 'post',
                url: '/list?page=' + (Number(currenPage) + 1),
                success: function(msg) {
                    if (msg.code !== 200) return;
                    var data = msg.data,
                        html = '',
                        pageNum = msg.pageNum;
                    currenPage = msg.page;
                    $.each(data, function(i, v) {
                        html += '<li class="item">' +
                            '<div class="item-inner">' +
                            '<a href="' + v.articleLink + '" target="_blank" class="item-link">' +
                            '<h3>' + v.articleTitle + '</h3>' +
                            '<div class="meto-row"><span class="tags bule">' + v.articleTag + '</span><span>' + v.articleAuthor + '</span><span>' + v.articlePvn + '</span></div>' +
                            '</a>' +
                            '</div>' +
                            '</li>';
                    })
                    $("#item-list-box").append(html);
                    if (pageNum == currenPage) {
                        $btnMore.hide();
                    }
                },
                error: function(err) {
                    console.log(err)
                }
            })
        });
    })
</script>

</html>